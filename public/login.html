<!DOCTYPE html>

<html class="light" lang="es"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Registro - Sistema de Autenticación Segura</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
          darkMode: "class",
          theme: {
            extend: {
              colors: {
                "primary": "#3b1e8a",
                "background-light": "#f6f6f8",
                "background-dark": "#161220",
              },
              fontFamily: {
                "display": ["Inter"]
              },
              borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
            },
          },
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 min-h-screen flex items-center justify-center p-4">
<!-- Background Decoration Elements (Subtle Tech Aesthetic) -->
<div class="fixed inset-0 overflow-hidden pointer-events-none">
<div class="absolute -top-[10%] -left-[10%] w-[40%] h-[40%] bg-primary/5 rounded-full blur-3xl"></div>
<div class="absolute -bottom-[10%] -right-[10%] w-[40%] h-[40%] bg-primary/10 rounded-full blur-3xl"></div>
</div>
<div class="relative w-full max-w-[440px]">
<!-- Registration Card -->
<div class="bg-white dark:bg-slate-900/50 backdrop-blur-sm border border-slate-200 dark:border-slate-800 rounded-xl shadow-xl overflow-hidden">
<!-- Card Header -->
<div class="px-8 pt-8 pb-6 text-center">
<div class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 text-primary mb-4">
<span class="material-icons-round text-3xl">verified_user</span>
</div>
<h1 class="text-2xl font-bold tracking-tight text-slate-900 dark:text-white">Crear Cuenta</h1>
<p class="text-slate-500 dark:text-slate-400 mt-2 text-sm">Sistema de Autenticación Segura v2.0</p>
</div>

<!-- Mensaje de error/éxito (oculto por defecto) -->
<div id="mensaje" class="hidden mx-8 mb-4 p-3 rounded-lg text-sm font-medium"></div>

<!-- Form -->
<form id="registroForm" class="px-8 pb-8 space-y-5">
<!-- Username Field -->
<div class="space-y-1.5">
<label class="text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 ml-1" for="username">
                        Nombre de Usuario
                    </label>
<div class="relative group">
<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400 group-focus-within:text-primary transition-colors">
<span class="material-icons-round text-sm">person</span>
</div>
<input class="block w-full pl-10 pr-4 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm transition-all focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none" id="username" name="username" placeholder="usuario123" required="" type="text"/>
</div>
</div>
<!-- Password Field -->
<div class="space-y-1.5">
<label class="text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 ml-1" for="password">
                        Contraseña
                    </label>
<div class="relative group">
<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400 group-focus-within:text-primary transition-colors">
<span class="material-icons-round text-sm">lock</span>
</div>
<input class="block w-full pl-10 pr-10 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm transition-all focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none" id="password" name="password" placeholder="••••••••" required="" type="password"/>
<button class="absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 transition-colors" type="button">
<span class="material-icons-round text-sm">visibility</span>
</button>
</div>
<!-- Password Strength Meter (Visual Simulation) -->
<div class="mt-2.5 space-y-1.5">
<div class="flex gap-1.5 h-1.5">
<div class="flex-1 bg-primary rounded-full" id="bar1"></div>
<div class="flex-1 bg-primary rounded-full" id="bar2"></div>
<div class="flex-1 bg-slate-200 dark:bg-slate-700 rounded-full" id="bar3"></div>
<div class="flex-1 bg-slate-200 dark:bg-slate-700 rounded-full" id="bar4"></div>
</div>
<div class="flex justify-between items-center px-0.5">
<span class="text-[10px] font-medium text-primary" id="fuerzaTexto">Escribe una contraseña</span>
<span class="text-[10px] text-slate-400" id="fuerzaConsejo">Mínimo 8 caracteres</span>
</div>
</div>
</div>
<!-- Confirm Password Field -->
<div class="space-y-1.5">
<label class="text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 ml-1" for="confirm-password">
                        Confirmar Contraseña
                    </label>
<div class="relative group">
<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400 group-focus-within:text-primary transition-colors">
<span class="material-icons-round text-sm">verified</span>
</div>
<input class="block w-full pl-10 pr-4 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm transition-all focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none" id="confirm-password" name="confirm-password" placeholder="••••••••" required="" type="password"/>
</div>
</div>
<!-- Terms & Conditions (Implicit Security Policy) -->
<div class="flex items-start gap-3 px-1 pt-1">
<input class="mt-1 rounded border-slate-300 text-primary focus:ring-primary h-4 w-4" id="terms" type="checkbox"/>
<label class="text-xs text-slate-500 dark:text-slate-400 leading-normal" for="terms">
                        Acepto los <a class="text-primary hover:underline" href="#">términos de seguridad</a> y la política de privacidad de datos universitarios.
                    </label>
</div>
<!-- Submit Button -->
<button class="w-full bg-primary hover:bg-primary/90 text-white font-semibold py-3 rounded-lg shadow-lg shadow-primary/20 transition-all active:scale-[0.98] flex items-center justify-center gap-2 mt-4" type="submit" id="submitBtn">
<span id="btnTexto">Crear Cuenta</span>
<span class="material-icons-round text-sm" id="btnIcono">arrow_forward</span>
</button>
</form>
<!-- Footer Link -->
<div class="bg-slate-50/50 dark:bg-slate-800/30 px-8 py-5 border-t border-slate-100 dark:border-slate-800 text-center">
<p class="text-sm text-slate-500 dark:text-slate-400">
                    ¿Ya tienes cuenta?
                    <a class="text-primary font-semibold hover:underline decoration-2 underline-offset-4" href="/iniciar-sesion.html">Inicia sesión</a>
</p>
</div>
</div>
<!-- System Status Bar -->
<div class="mt-8 flex items-center justify-center gap-6 text-[11px] font-medium text-slate-400 uppercase tracking-widest">
<div class="flex items-center gap-1.5">
<span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                Servidor Activo
            </div>
<div class="flex items-center gap-1.5">
<span class="material-icons-round text-[14px]">encrypted</span>
                SHA-256 + Salt
            </div>
</div>
</div>

<script>
    // ============================================================
    //  LÓGICA DEL FORMULARIO DE REGISTRO
    // ============================================================

    const form = document.getElementById('registroForm');
    const mensajeDiv = document.getElementById('mensaje');
    const passwordInput = document.getElementById('password');

    // ---- MEDIDOR DE FUERZA DE CONTRASEÑA ----
    // Evalúa la contraseña en tiempo real mientras el usuario escribe
    passwordInput.addEventListener('input', () => {
        const pwd = passwordInput.value;
        let fuerza = 0;

        if (pwd.length >= 8) fuerza++;           // Longitud mínima
        if (/[A-Z]/.test(pwd)) fuerza++;         // Tiene mayúsculas
        if (/[0-9]/.test(pwd)) fuerza++;         // Tiene números
        if (/[^A-Za-z0-9]/.test(pwd)) fuerza++;  // Tiene símbolos

        const barras = [
            document.getElementById('bar1'),
            document.getElementById('bar2'),
            document.getElementById('bar3'),
            document.getElementById('bar4')
        ];
        const textoFuerza = document.getElementById('fuerzaTexto');
        const consejo = document.getElementById('fuerzaConsejo');

        const colores = ['bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-emerald-500'];
        const textos = ['Muy débil', 'Débil', 'Media', 'Fuerte'];
        const consejos = ['Muy corta', 'Agrega mayúsculas', 'Agrega símbolos', '¡Excelente!'];
        const inactivo = 'bg-slate-200 dark:bg-slate-700';

        barras.forEach((barra, i) => {
            // Limpiar clases de color anteriores
            barra.className = `flex-1 rounded-full ${i < fuerza ? colores[fuerza - 1] : inactivo}`;
        });

        if (pwd.length === 0) {
            textoFuerza.textContent = 'Escribe una contraseña';
            consejo.textContent = 'Mínimo 8 caracteres';
        } else {
            textoFuerza.textContent = textos[fuerza - 1] || 'Muy débil';
            consejo.textContent = consejos[fuerza - 1] || 'Agrega más caracteres';
        }
    });

    // ---- MOSTRAR MENSAJE ----
    function mostrarMensaje(texto, tipo) {
        mensajeDiv.textContent = texto;
        mensajeDiv.className = 'mx-8 mb-4 p-3 rounded-lg text-sm font-medium';
        if (tipo === 'error') {
            mensajeDiv.classList.add('bg-red-50', 'text-red-700', 'border', 'border-red-200');
        } else {
            mensajeDiv.classList.add('bg-emerald-50', 'text-emerald-700', 'border', 'border-emerald-200');
        }
    }

    // ---- ENVÍO DEL FORMULARIO ----
    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        const terms = document.getElementById('terms').checked;

        // Validaciones del lado del cliente
        // IMPORTANTE: Estas validaciones son para UX (experiencia del usuario).
        // Las validaciones de SEGURIDAD están en el servidor.
        // Un atacante puede saltarse el frontend fácilmente con DevTools.

        if (password !== confirmPassword) {
            mostrarMensaje('Las contraseñas no coinciden.', 'error');
            return;
        }

        if (password.length < 8) {
            mostrarMensaje('La contraseña debe tener al menos 8 caracteres.', 'error');
            return;
        }

        if (!terms) {
            mostrarMensaje('Debes aceptar los términos de seguridad.', 'error');
            return;
        }

        // Cambiar botón a "cargando"
        const btnTexto = document.getElementById('btnTexto');
        const btnIcono = document.getElementById('btnIcono');
        const submitBtn = document.getElementById('submitBtn');
        btnTexto.textContent = 'Registrando...';
        btnIcono.textContent = 'hourglass_empty';
        submitBtn.disabled = true;

        try {
            // Enviar datos al servidor via POST
            const respuesta = await fetch('/api/registro', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const datos = await respuesta.json();

            if (respuesta.ok) {
                mostrarMensaje('¡Cuenta creada exitosamente! Redirigiendo al login...', 'exito');
                // Redirigir al login después de 2 segundos
                setTimeout(() => {
                    window.location.href = '/iniciar-sesion.html';
                }, 2000);
            } else {
                mostrarMensaje(datos.error, 'error');
            }
        } catch (error) {
            mostrarMensaje('Error de conexión con el servidor.', 'error');
        } finally {
            btnTexto.textContent = 'Crear Cuenta';
            btnIcono.textContent = 'arrow_forward';
            submitBtn.disabled = false;
        }
    });
</script>

</body></html>
